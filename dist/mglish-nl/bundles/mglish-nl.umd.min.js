!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/common/http"),require("rxjs"),require("@angular/core")):"function"==typeof define&&define.amd?define("mglish-nl",["exports","@angular/common/http","rxjs","@angular/core"],t):t(e["mglish-nl"]={},e.ng.common.http,e.rxjs,e.ng.core)}(this,function(e,r,c,t){"use strict";var n=function(){function e(e){this.http=e,this.debug=!0}return e.prototype.request=function(e,t){var n={document:{content:e,type:"PLAIN_TEXT"},encodingType:"UTF8"},o={headers:{"Content-Type":"application/json"},params:(new r.HttpParams).append("key",t)};return this.http.post("https://cors-anywhere.herokuapp.com/https://language.googleapis.com/v1beta2/documents:analyzeSyntax",JSON.stringify(n),o)},e.prototype.chunkText=function(e,n){var o=this,r=e.replace(/\“|\”/g,'"').replace(/\’/g,"'").replace(/\–/g,"-").replace(/\…/g,"...");return new c.Observable(function(t){return o.request(r,n).subscribe(function(e){t.next(o.getTextWithChunk(e,r)),t.complete()},function(e){t.error(e)})})},e.prototype.chunkTextArray=function(e,t){for(var o=this,r="",n=0;n<e.length;n++)r+=e[n]+"　";return r=r.replace(/\“|\”/g,'"').replace(/\’/g,"'").replace(/\–/g,"-").replace(/\…/g,"..."),new c.Observable(function(n){return o.request(r,t).subscribe(function(e){var t=o.getTextWithChunk(e,r.replace(/　/g,"|||")).split(/\|{3,}/g);t.pop(),n.next(t),n.complete()},function(e){n.error(e)})})},e.prototype.textWithMitre=function(e,n){var o=this,r=e.replace(/\“|\”/g,'"').replace(/\’/g,"'").replace(/\–/g,"-");return new c.Observable(function(t){return o.request(r,n).subscribe(function(e){t.next(o.getTextWithMitre(e,r)),t.complete()},function(e){t.error(e)})})},e.prototype.textWithBreakLine=function(e,n){var o=this,r=e.replace(/\“|\”/g,'"').replace(/\’/g,"'").replace(/\–/g,"-");return new c.Observable(function(t){return o.request(r,n).subscribe(function(e){t.next(o.getTextWithBreakLine(e,r)),t.complete()},function(e){t.error(e)})})},e.prototype.chunkPositionList=function(e,n){var o=this,r=e.replace(/\“|\”/g,'"').replace(/\’/g,"'").replace(/\–/g,"-");return new c.Observable(function(t){return o.request(r,n).subscribe(function(e){t.next(o.handle(e,r)),t.complete()},function(e){t.error(e)})})},e.prototype.getTextWithMitre=function(e,t){var n=this.handle(e,t);if(0===Object.keys(n).length)return"「"+t+"」";var o="",r=0,c="";for(var a in n)if(n.hasOwnProperty(a)){for(var h=t.substring(n[r],n[a]),d=0,s=h.length-1;d<h.length&&"\n"===h.charAt(d);)d++;for(;0<s&&"\n"===h.charAt(s);)s--;s=h.length-1-s,c="\n".repeat(d),c+="「",c+=h.trim(),c+="」"+"\n".repeat(s),0===s&&(c+="　"),o+=c,r=+a}for(var i=t.substring(n[r],t.length),l=0;l<i.length&&"\n"===i.charAt(l);)l++;return c=0===l?"":"\n".repeat(l),o+=c+="「"+i.trim()+"」"},e.prototype.getTextWithBreakLine=function(e,t){var n=this.handle(e,t);if(0===Object.keys(n).length)return t;var o=[],r=0,c=void 0;for(var a in n)n.hasOwnProperty(a)&&(c=t.substring(n[r],n[a]),o.push(c),r=+a);return c=t.substring(n[r],t.length),o.push(c),console.log(o),o.join("\n")},e.prototype.getTextWithChunk=function(e,t){var n=this.handle(e,t);if(0===Object.keys(n).length)return t;var o=[],r=0,c=void 0;for(var a in n)n.hasOwnProperty(a)&&(c=t.substring(n[r],n[a]),o.push(c),r=+a);return c=t.substring(n[r],t.length),o.push(c),console.log(o),o.join("|")},e.prototype.handle=function(e,t){for(var n={},o=e.tokens,r=0;r<o.length;r++)switch(o[r].dependencyEdge.label){case"ROOT":case"CCOMP":case"RCMOD":this.handleVerb(o,r,n);break;case"CONJ":(this.isConjugateVerb(r,o)||"ROOT"===o[o[r].dependencyEdge.headTokenIndex].dependencyEdge.label||"CCOMP"===o[o[r].dependencyEdge.headTokenIndex].dependencyEdge.label||"RCMOD"===o[o[r].dependencyEdge.headTokenIndex].dependencyEdge.label||"ADVCL"===o[o[r].dependencyEdge.headTokenIndex].dependencyEdge.label||"PARATAXIS"===o[o[r].dependencyEdge.headTokenIndex].dependencyEdge.label)&&this.handleVerb(o,r,n);break;case"PARATAXIS":this.isConjugateVerb(r,o)&&this.handleVerb(o,r,n);break;case"ADVCL":"VERB"===o[r].partOfSpeech.tag&&this.handleVerb(o,r,n);break;case"PCOMP":1<r&&r<o.length-1&&(r<o.length-2&&this.checkLabel(["ACOMP"],r+1,o)?this.addChunk(n,r+2,o,"pcomp + acomp:"+r):this.addChunk(n,r+1,o,"pcomp:"+r));break;case"PREP":if(2<r&&this.checkLabel(["AUX","AUXPASS"],r-1,o)&&o[r-1].dependencyEdge.headTokenIndex>r)break;if(2<r&&this.checkLabel(["MWE"],r-1,o)&&o[r-1].dependencyEdge.headTokenIndex===r){this.checkCCAndChunk(n,r-1,o,"prep mwe:"+r);break}if(0<r&&o[r].dependencyEdge.headTokenIndex!==r-1&&o[r-1].dependencyEdge.headTokenIndex!==r){if(1<r&&this.isConjugateVerb(r-2,o))break;this.checkCCAndChunk(n,r,o,"prep:"+r)}break;case"MARK":1<r&&this.addChunk(n,r,o,"mark: "+r);break;case"NSUBJ":case"NSUBJPASS":this.handleSubj(o,r,n);break;case"P":"."!==o[r].text.content&&"!"!==o[r].text.content&&"?"!==o[r].text.content||(r<o.length-1&&console.log("-"===o[r+1].text.content),r<o.length-1&&"."!==o[r+1].text.content&&"!"!==o[r+1].text.content&&"?"!==o[r+1].text.content&&"-"!==o[r+1].text.content&&this.addChunk(n,r+1,o,"punctuation: "+r));break;case"CC":var c=o[r].dependencyEdge.headTokenIndex;if(r<c)break;for(var a=void 0,h=r+1;h<o.length;h++)if(this.checkLabel(["CONJ"],h,o)&&o[h].dependencyEdge.headTokenIndex===c){a=h;break}if(void 0===a)break;for(var d=a-c,s=c-1;0<s&&o[s].dependencyEdge.headTokenIndex===c;)d++,s--;for(var i=a+1;i>o.length-1&&o[i].dependencyEdge.headTokenIndex===a;)d++,i++;2<d&&this.addChunk(n,r,o,"cc :"+r);break;case"AUX":0<r&&r<o.length-2&&"PRT"===o[r].partOfSpeech.tag&&"VERB"===o[r+1].partOfSpeech.tag&&this.addChunk(n,r,o,"aux :"+r);break;case"VMOD":2<r&&"PRT"!==o[r-1].partOfSpeech.tag&&this.addChunk(n,r,o,"vmod :"+r);break;case"ADVMOD":2<r&&("as"===o[r].text.content||"when"===o[r].text.content||"where"===o[r].text.content)&&this.addChunk(n,r,o,"advmod :"+r)}return this.handleTooLongPart(o,n),this.removeTooShortPart(o,n),n},e.prototype.handleVerb=function(e,t,n){t!==e.length-1&&(this.checkLabel(["PRT","XCOMP"],t+1,e)&&e[t+1].dependencyEdge.headTokenIndex===t||this.checkLabel(["ACOMP"],t+1,e))?t+1<e.length-1&&this.addChunk(n,t+2,e,"verb :"+t):t!==e.length-1&&this.addChunk(n,t+1,e,"verb :"+t)},e.prototype.handleSubj=function(e,t,n){if(!(t<e.length-1&&(e[t+1].text.content.startsWith("'")||e[t+1].text.content.startsWith("’")))){for(var o=e[t].dependencyEdge.headTokenIndex,r=e[o].dependencyEdge.headTokenIndex,c=t-1;0<=c&&(e[c].dependencyEdge.headTokenIndex===t||e[c].dependencyEdge.headTokenIndex===c+1||e[c].dependencyEdge.headTokenIndex===o||e[c].dependencyEdge.headTokenIndex===r&&!this.checkLabel(["P"],c,e)||this.checkLabel(["ADVMOD","AMOD","PS"],t-1,e));)c--;if(0<c&&this.checkCCAndChunk(n,c+1,e,"nsubj: "+t),o<t)t!==e.length-1&&(this.checkLabel(["PRT"],o+1,e)&&e[o+1].dependencyEdge.headTokenIndex===o||this.checkLabel(["ACOMP"],o+1,e))?o+1<e.length-1&&delete n[o+2]:o!==e.length-1&&delete n[o+1];else{var a=o-t+1;o<e.length-1&&this.checkLabel(["PRT"],o+1,e)&&e[o+1].dependencyEdge.headTokenIndex===t&&a++;for(var h=t-1;0<=h&&e[h].dependencyEdge.headTokenIndex<=o&&e[h].dependencyEdge.headTokenIndex>=h;)a++,h--;5<a&&(2<o&&this.checkLabel(["AUX","AUXPASS"],o-2,e)?this.addChunk(n,o-2,e,"subj + aux 2:"+t):1<o&&this.checkLabel(["AUX","AUXPASS"],o-1,e)?this.addChunk(n,o-1,e,"subj + aux 1:"+t):1<o&&this.addChunk(n,o,e,"subj:"+t)),console.log("count "+t+": "+a)}}},e.prototype.handleTooLongPart=function(e,t){for(var n,o=Object.keys(t),r=0,c=0;c<o.length;c++)if(n=o[c],t.hasOwnProperty(n)){if(6<=+n-r){var a=+e[n].text.beginOffset-+e[r].text.beginOffset;if(console.log(a),35<=a){for(var h=[],d=[],s=r+2;s<+n;s++)switch(e[s].dependencyEdge.label){case"PREP":if(2<s&&this.checkLabel(["AUX","AUXPASS"],s-1,e)&&e[s-1].dependencyEdge.headTokenIndex>s)break;h.push(s);break;case"P":","!==e[s].text.content&&";"!==e[s].text.content||d.push(s)}this.chunkTooLong(e,t,h,d,+n,r)}else console.log("not too long 1: "+a)}r=+n}if(6<=+(n=e.length-1)-r+1)if(35<=(a=+e[n].text.beginOffset-+e[r].text.beginOffset)){console.log(r+" to "+n+" too long: "+a);for(h=[],d=[],s=r+2;s<+n;s++)switch(e[s].dependencyEdge.label){case"PREP":h.push(s);break;case"P":","!==e[s].text.content&&";"!==e[s].text.content||d.push(s)}this.chunkTooLong(e,t,h,d,+n,r)}else console.log("not too long 2: "+a);console.log(t)},e.prototype.chunkTooLong=function(e,t,n,o,r,c){console.log(c+" to "+r+" too long: ");var a=null;if(0!==n.length){console.log(n);var h=(r+c)/2;if(console.log("goal: "+h),(a=n.reduce(function(e,t){return Math.abs(t-h)<Math.abs(e-h)?t:e}))<r&&c<a){this.addChunk(t,a,e,"too long part prep: "+a);var d=n.indexOf(a);n.splice(d,1)}else a=null}else if(0!==o.length){console.log(o);var s=(+r+c)/2;if(console.log("goal: "+s),a=o.reduce(function(e,t){return Math.abs(t-s)<Math.abs(e-s)?t:e}),console.log("closest: "+a),a<r&&c<a){this.addChunk(t,a+1,e,"too long part comma:"+a);d=o.indexOf(a);o.splice(d,1)}else a=null}if(null!==a){var i=+e[a].text.beginOffset-+e[c].text.beginOffset,l=+e[r].text.beginOffset-+e[a].text.beginOffset;console.log("1: "+i+" 2: "+l),30<i&&this.chunkTooLong(e,t,n,o,a,c),30<l&&this.chunkTooLong(e,t,n,o,r,a)}},e.prototype.removeTooShortPart=function(e,t){for(var n,o,r=Object.keys(t),c=0,a=0;a<r.length;a++)n=r[a],t.hasOwnProperty(n)&&(1===(o=+n-c)&&("VERB"===e[c].partOfSpeech.tag&&!this.checkLabel(["VMOD"],c,e)||0<c&&this.checkLabel(["P"],c-1,e)?delete t[n]:e[c].dependencyEdge.headTokenIndex<c||!this.checkLabel(["ADVMOD"],c,e)&&this.isConjugateVerb(c-1,e)?(delete t[c],console.log("previous")):(delete t[n],console.log("next")),this.debug&&console.log("remove chunk too short: "+n)),2===o&&0!==c&&this.checkLabel(["P"],+n-1,e)&&(delete t[c],this.debug&&console.log("remove chunk too short: "+n)),c=+n);1===(o=+(n=e.length-1)-c+1)&&(delete t[c],this.debug&&console.log("remove chunk too short: "+n)),2===o&&0!==c&&this.checkLabel(["P"],+c+1,e)&&(delete t[c],this.debug&&console.log("remove chunk too short: "+n)),console.log(t)},e.prototype.addChunk=function(e,t,n,o){if(0<t&&t<n.length-1)if(this.debug&&console.log("add chunk "+t+" :"+o),1<t&&this.checkLabel(["P"],t-1,n)&&("("===n[t-1].text.content||'"'===n[t-1].text.content&&n[t-1].dependencyEdge.headTokenIndex!==t))e[t-1]=n[t-2].text.beginOffset+n[t-2].text.content.length;else{for(var r=t;r<n.length&&this.checkLabel(["P"],r,n)&&(!(r<n.length-1)||"-"!==n[r].text.content&&"("!==n[r].text.content&&'"'!==n[r].text.content);)r++;r<n.length-2&&0<r&&(n[r-1].text.content.includes("　")?e[r]=n[r-1].text.beginOffset+n[r-1].text.content.split("　")[0].length:e[r]=n[r-1].text.beginOffset+n[r-1].text.content.length)}},e.prototype.checkCCAndChunk=function(e,t,n,o){this.checkLabel(["CC"],t-1,n)?this.addChunk(e,t-1,n,o):this.addChunk(e,t,n,o)},e.prototype.checkLabel=function(e,t,n){if(t<0||t>=n.lenght)return!1;for(var o=!1,r=0;r<e.length;r++)if(n[t].dependencyEdge.label===e[r]){o=!0;break}return o},e.prototype.checkDependency=function(e,t,n){return n[t].dependencyEdge.headTokenIndex===e},e.prototype.checkTag=function(e,t,n){return n[t].partOfSpeech.tag===e},e.prototype.isConjugateVerb=function(e,t){return!(e<0||e>=t.lenght)&&("VERB"===t[e].partOfSpeech.tag&&("TENSE_UNKNOWN"!==t[e].partOfSpeech.tense||t[e].lemma!==t[e].text.content))},e.decorators=[{type:t.Injectable,args:[{providedIn:"root"}]}],e.ctorParameters=function(){return[{type:r.HttpClient}]},e.ngInjectableDef=t.defineInjectable({factory:function(){return new e(t.inject(r.HttpClient))},token:e,providedIn:"root"}),e}(),o=function(){function e(){}return e.prototype.ngOnInit=function(){},e.decorators=[{type:t.Component,args:[{selector:"lib-mglish-nl",template:"\n    <p>\n      mglish-nl works!\n    </p>\n  "}]}],e.ctorParameters=function(){return[]},e}(),a=function(){function e(){}return e.decorators=[{type:t.NgModule,args:[{declarations:[o],imports:[],exports:[o]}]}],e}();e.MglishNlService=n,e.MglishNlComponent=o,e.MglishNlModule=a,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=mglish-nl.umd.min.js.map